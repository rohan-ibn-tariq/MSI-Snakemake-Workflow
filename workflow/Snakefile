"""
MSI Variant Detection and Analysis Workflow
==========================================

A comprehensive pipeline for simulating and detecting microsatellite instability (MSI) 
variants in human chromosome 22 using state-of-the-art bioinformatics tools.

Workflow Overview:
- Genome acquisition from Ensembl
- Tandem repeat discovery with PyTRF  
- Variant simulation using Mason toolkit
- MSI-targeted indel injection
- Probabilistic variant calling with VarLociraptor
- Statistical quantification and analysis

Tools: Mason, PyTRF, VarLociraptor, BCFtools
Reference: Human genome GRCh38, Chromosome 22
Output: MSI burden quantification and visualization
"""

configfile: "workflow/config/config.yaml"


CHROMOSOMES = config["chromosomes"]


include: "rules/data_preparation.smk"
include: "rules/simulation_processing.smk"
include: "rules/data_analysis.smk"


rule all:
    input:
        # Data preparation outputs
        expand("workflow/resources/reference-sequence/chr{chrom}/genome.fasta", chrom=CHROMOSOMES),
        expand("workflow/resources/reference-sequence/chr{chrom}/genome.fasta.bwt", chrom=CHROMOSOMES),
        expand("results/data-preparation/repeats/chr{chrom}_pytrf_output.csv", chrom=CHROMOSOMES),
        expand("workflow/resources/annotation/chr{chrom}.gtf", chrom=CHROMOSOMES),
        # "results/data-preparation/ms-bed/genome.bed",
        expand("results/data-preparation/ms-bed/chr{chrom}_sample_test.bed", chrom=CHROMOSOMES),
        # Simulation processing outputs
        expand("results/simulation-processing/simulated-mason-variant/chr{chrom}_sim_raw.vcf", chrom=CHROMOSOMES),
        expand("results/simulation-processing/simulated-mason-variant/chr{chrom}_sim.vcf", chrom=CHROMOSOMES),
        expand("results/simulation-processing/msi-indels-vcf/chr{chrom}_sim_indels.vcf", chrom=CHROMOSOMES),
        expand("results/simulation-processing/simulated-bam/chr{chrom}_alignments.bam", chrom=CHROMOSOMES),
        expand("results/simulation-processing/varlociraptor-calls/chr{chrom}_variants.bcf", chrom=CHROMOSOMES),
        # Analysis results outputs
        expand("results/data-analysis/varlociraptor-calls/chr{chrom}_variants.vcf", chrom=CHROMOSOMES),
        expand("results/data-analysis/coding-regions/chr{chrom}_coding.bed", chrom=CHROMOSOMES),
        expand("results/data-analysis/coding-intersected/chr{chrom}_coding_variants.vcf", chrom=CHROMOSOMES),
        expand("results/data-analysis/coding-msi-bed/chr{chrom}_coding_msi.bed", chrom=CHROMOSOMES),
        expand("results/data-analysis/coding-regions/chr{chrom}_coding_for_vcf.bed", chrom=CHROMOSOMES),
        expand("results/data-analysis/msi-quantification/chr{chrom}_report.html", chrom=CHROMOSOMES),
        expand("results/data-analysis/msi-analysis-coding/chr{chrom}/msi_results.json", chrom=CHROMOSOMES),
        expand("results/data-analysis/msi-analysis-full/chr{chrom}/msi_results.json", chrom=CHROMOSOMES),
